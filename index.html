<!DOCTYPE html>
<html>
<head>
    <title>CS 416 - Data Visualization Final Project: FAANG + SPX</title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
</head>
<body>
    <div id="annotation_example">
        <svg width="460" height="400" id="example1"></svg>
    </div>

    <div id="main_chart"></div>
    
    <script>

    const annotations = [
      {
        note: {
          label: "Here is the annotation label",
          title: "Annotation title"
        },
        x: 100,
        y: 100,
        dy: 100,
        dx: 100
      }
    ]

    const makeAnnotations = d3.annotation()
      .annotations(annotations)
    d3.select("#example1")
      .append("g")
      .call(makeAnnotations)
    </script>

    <script>


    var margin = {top: 100, right: 100, bottom: 100, left: 100},
        width = window.innerWidth * 0.90 - margin.left - margin.right,
        height = window.innerHeight * 0.90 - margin.top - margin.bottom;

    var svg = d3.select("#main_chart")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://raw.githubusercontent.com/arigemini/cs416_final_project/main/SPX_FAANG.csv",

      function(d){
        return {
            date : d3.timeParse("%Y-%m-%d")(d.Date),
            spx : +d.SPX,
            meta: +d.META,
            amzn: +d.AMZN,
            aapl: +d.AAPL,
            nflx: +d.NFLX,
            goog: +d.GOOG,
        }
      },

      function(data) {

        var x = d3.scaleTime()
          .domain(d3.extent(data, function(d) { return d.date; }))
          .range([ 0, width ]);
        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        var y = d3.scaleLinear()
          .domain([0, d3.max(data, function(d) { return d.spx; })])
          .range([ height, 0 ]);
        svg.append("g")
          .call(d3.axisLeft(y));

        var y2 = d3.scaleLinear()
          .domain([0, 800])
          .range([ height, 0 ]);
        svg.append("g")
          .attr("transform", "translate(" + width + ",0)")
          .call(d3.axisRight(y2));

                svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height + margin.bottom / 2)
            .text("Date");

        svg.append("text")
            .attr("text-anchor", "end")
            .attr("y", -margin.left / 2)
            .attr("x", (-height + margin.top) / 2)
            .attr("transform", "rotate(-90)")
            .text("S&P 500 Index");

        svg.append("text")
            .attr("text-anchor", "end")
            .attr("y", width + margin.right / 2)
            .attr("x", (-height + margin.top) / 2)
            .attr("transform", "rotate(-90)")
            .text("(FAANG) Share Price");
          
        tickers = ["spx", "meta", "amzn", "aapl", "nflx", "goog"];
          
        var color = d3.scaleOrdinal()
          .domain(tickers)
          .range(["gray", "blue", "orange", "pink", "red", "green"]);

        var legendItemWidth = 100;
        var legend = svg.selectAll(".legend")
          .data(tickers)
          .enter()
          .append("g")
          .attr("transform", function(d,i) { return "translate(" + ((i * legendItemWidth) + (width - tickers.length * legendItemWidth) / 2) + "," + (-margin.top / 2) + ")"; })
	      .attr("class","legend");
	
        var rects = legend.append('rect')
        	.attr("width",legendItemWidth / 2)
        	.attr("height",2)
        	.attr("fill", function(d) { return color(d); });
        	
        var text = legend.append('text')
        	.attr("x", 15)
        	.attr("y",12)
        	.text(function(d) { return d; });
          
        svg.append("path")
          .datum(data)
          .attr("fill", "none")
          .attr("stroke", color("spx"))
          .attr("stroke-width", 1.5)
          .attr("d", d3.line()
            .x(function(d) { return x(d.date) })
            .y(function(d) { return y(d.spx) })
          );

        ["meta", "amzn", "aapl", "nflx", "goog"].forEach((ticker) => {
            svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", color(ticker))
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function(d) { return x(d.date); })
                .y(function(d) { 
                    console.log(ticker, y2[d.ticker]);
                    return y2(d[ticker]); })
            );
        })

      }
    )

    </script>

</body>
</html>
